<!doctype html>
<html lang="ms">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Kindness Rain for Fadhlin</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600;700&family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
      :root{
        --bg1:#fff7fb; --bg2:#ffe9f6;
        --card:#ffffff; --text:#161617; --muted:#6a6a6a;

        /* warna lalai (akan diubah ikut masa melalui JS) */
        --heart:#ff4fa0;        /* warna hati */
        --bubble:#ffffff;       /* latar bubble */
        --bubble-b:#00000010;   /* border bubble */
      }
      *{box-sizing:border-box}
      html,body{height:100%;margin:0}
      body{
        font-family:Quicksand, system-ui, Segoe UI, Arial, sans-serif;
        background:radial-gradient(80% 80% at 50% 20%, var(--bg2), var(--bg1));
        color:var(--text); overflow:hidden;
        -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
      }

      .wrap{position:fixed; inset:0; display:grid; place-items:center; padding:16px}
      .card{
        position:relative; width:min(900px, 94vw);
        border-radius:22px; background:var(--card);
        box-shadow:0 18px 44px rgba(0,0,0,.12);
        padding:22px 14px 18px; overflow:hidden;
      }

      /* Tajuk */
      .title{
        font-family:"Dancing Script", cursive; font-weight:700;
        font-size:clamp(26px,6.2vw,54px); line-height:1.1;
        color:var(--heart); text-align:center; margin:2px 8px 2px;
        text-shadow:0 0 18px #00000022;
        animation:fadeDown .7s ease-out both;
      }
      .sub{ text-align:center; font-weight:700; color:#ff86bf; margin:4px 0 10px }
      @keyframes fadeDown{ from{opacity:0; transform:translateY(-8px)} to{opacity:1; transform:translateY(0)} }

      /* Kawasan hujan */
      .sky{
        position:relative; height:min(62vh, 560px);
        border-radius:18px; background:linear-gradient(180deg, rgba(255,255,255,.65), rgba(255,255,255,.35));
        overflow:hidden; margin:0 10px; box-shadow:inset 0 0 0 1px rgba(0,0,0,.04);
      }

      /* Titisan hati + mesej */
      .drop{
        position:absolute; top:-80px;
        display:flex; align-items:center; gap:10px;
        transform:translateX(-50%);
        animation:fall var(--dur,12s) linear forwards;
        will-change:transform,opacity;
      }
      .heart{
        font-size:20px; line-height:1; color:var(--heart);
        filter:drop-shadow(0 6px 12px #00000028);
        animation:beat 1.8s ease-in-out infinite;
      }
      @keyframes beat{ 0%,100%{transform:scale(1)} 50%{transform:scale(1.12)} }

      .bubble{
        max-width:min(62vw, 520px);
        background:var(--bubble);
        border:1px solid var(--bubble-b);
        padding:10px 14px; border-radius:14px;
        box-shadow:0 10px 22px rgba(0,0,0,.08);
        font-size:14px; color:#383838;
        white-space:nowrap;           /* biar satu baris panjang */
      }
      .bubble b{ color:var(--heart) }

      /* Jatuh perlahan & hilang hampir bawah (98%) */
      @keyframes fall{
        0%   { transform:translate(var(--x,0), -100px); opacity:0 }
        10%  { opacity:1 }
        98%  { opacity:1 }
        100% { transform:translate(var(--x,0), calc(100% + 120px)); opacity:0 }
      }

      /* Kawalan */
      .controls{
        display:flex; flex-wrap:wrap; gap:10px; justify-content:center;
        margin:12px 10px 6px;
      }
      .btn{
        background:linear-gradient(180deg, #ff8ec4, #ff5ea8);
        color:#fff; border:none; border-radius:999px; padding:10px 16px;
        font-weight:700; cursor:pointer; box-shadow:0 10px 20px rgba(255,94,168,.25);
      }
      .btn.secondary{
        background:#fff; color:#ff5ea8; border:2px solid #ff5ea8;
      }
      .btn:active{ transform:translateY(1px) }

      /* Hint */
      .hint{ text-align:center; font-size:12px; color:var(--muted); margin:6px 12px 4px }

      /* Footer mini */
      .footer{
        text-align:center; font-size:11px; color:#7a7a7a; margin:8px 0 2px
      }

      @media (max-width:520px){
        .card{border-radius:18px}
        .bubble{font-size:13px}
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="card">
        <h1 class="title">Kindness Rain for Fadhlin</h1>
        <p class="sub">Be happy</p>

        <div class="sky" id="sky" aria-label="Hujan kebaikan"></div>

        <div class="controls">
          <button class="btn" id="start">Start Rain</button>
          <button class="btn secondary" id="stop" disabled>Stop</button>
          <button class="btn secondary" id="dropOne">Drop 1</button>
        </div>
        <p class="hint">Tap <b>Start Rain</b> (bunyi aktif), atau <b>Drop 1</b> untuk satu titisan. Sentuh di langit untuk jatuhkan di lokasi sentuhan.</p>
        <div class="footer">for Fadhlin ‚Äî ‚ÄúSome days are heavy; let the kindness do the lifting.‚Äù</div>
      </div>
    </div>

    <script>
      const sky = document.getElementById('sky');
      const startBtn = document.getElementById('start');
      const stopBtn  = document.getElementById('stop');
      const oneBtn   = document.getElementById('dropOne');

      /* ===== Tema warna ikut masa (Asia/Kuala_Lumpur) ===== */
      function applyTimeTheme(){
        const h = new Date().getHours(); // waktu lokal device
        // pagi 5‚Äì11, siang 11‚Äì16, senja 16‚Äì19, malam 19‚Äì5
        if (h >= 5 && h < 11) {
          // pagi: pink lembut
          document.documentElement.style.setProperty('--heart',    '#ff72b3');
          document.documentElement.style.setProperty('--bubble',   '#ffffff');
          document.documentElement.style.setProperty('--bubble-b', '#00000012');
        } else if (h >= 11 && h < 16) {
          // siang: pink terang
          document.documentElement.style.setProperty('--heart',    '#ff3f96');
          document.documentElement.style.setProperty('--bubble',   '#ffffff');
          document.documentElement.style.setProperty('--bubble-b', '#00000014');
        } else if (h >= 16 && h < 19) {
          // senja: keunguan hangat
          document.documentElement.style.setProperty('--heart',    '#d754ff');
          document.documentElement.style.setProperty('--bubble',   '#fff7ff');
          document.documentElement.style.setProperty('--bubble-b', '#7b3ad720');
        } else {
          // malam: fuchsia pekat + bubble kebiruan halus
          document.documentElement.style.setProperty('--heart',    '#ff2d86');
          document.documentElement.style.setProperty('--bubble',   '#f7f9ff');
          document.documentElement.style.setProperty('--bubble-b', '#00104018');
        }
      }
      applyTimeTheme();

      /* ===== Mesej manis ===== */
      const msgs = [
        "Fadhlin, your heart is kind ‚Äî that matters most.",
        "It‚Äôs okay to rest. You‚Äôre not falling behind.",
        "Small wins count. Today‚Äôs enough.",
        "Your smile changes rooms. üòä",
        "You‚Äôve survived every tough day so far.",
        "Progress over perfection. Proud of you.",
        "Be gentle with yourself today.",
        "Storms pass. You won‚Äôt feel like this forever.",
        "You are loved more than you know.",
        "Tiny steps are still steps.",
        "Breathe. In‚Ä¶ out‚Ä¶ you‚Äôre safe here.",
        "You bring warmth to someone‚Äôs world.",
        "Fadhlin, you‚Äôre allowed to feel and still be strong.",
        "Let today be soft. You deserve it.",
        "One kind thought can brighten the whole day."
      ];
      let i = 0, timer=null, raining=false;

      /* ===== Bunyi ‚Äúpling‚Äù (Web Audio ‚Äî aktif selepas Start) ===== */
      let audioCtx = null;
      function playPling(){
        if(!audioCtx) return; // belum Start
        const ctx = audioCtx;
        const o = ctx.createOscillator();
        const g = ctx.createGain();

        // nada lembut major triad (random pilih C5/E5/G5)
        const freqs = [523.25, 659.25, 783.99];
        o.frequency.value = freqs[Math.floor(Math.random()*freqs.length)];

        o.type = 'sine';
        const now = ctx.currentTime;
        g.gain.setValueAtTime(0.0001, now);
        g.gain.linearRampToValueAtTime(0.12, now+0.01);
        g.gain.exponentialRampToValueAtTime(0.0001, now+0.35 + Math.random()*0.1);

        o.connect(g); g.connect(ctx.destination);
        o.start(now);
        o.stop(now+0.5);
      }

      /* ===== Util ===== */
      function nextMsg(){ const m = msgs[i % msgs.length]; i++; return m; }

      // Buat satu titisan ‚Äî slow & jauh ke bawah
      function makeDrop(xPx = null){
        const rect = sky.getBoundingClientRect();
        const x = xPx === null
          ? (rect.left + 40 + Math.random()*(rect.width - 80))
          : xPx;

        const d = document.createElement('div');
        d.className = 'drop';
        // durasi lebih perlahan (10‚Äì14s)
        d.style.setProperty('--dur', (10 + Math.random()*4) + 's');
        d.style.setProperty('--x', `${x - rect.left}px`);

        const heart = document.createElement('div');
        heart.className = 'heart';
        heart.textContent = '‚ù§';

        const bubble = document.createElement('div');
        bubble.className = 'bubble';

        // Taip huruf satu-satu (perlahan)
        const text = `‚ô• ${nextMsg()}`;
        let p = 0;
        const typer = setInterval(()=>{
          bubble.textContent = text.slice(0, p++);
          if(p > text.length) clearInterval(typer);
        }, 28); // kelajuan menaip

        d.appendChild(heart);
        d.appendChild(bubble);
        sky.appendChild(d);

        playPling();

        // auto remove selepas animasi tamat (turun sampai bawah)
        d.addEventListener('animationend', () => d.remove());
      }

      /* ===== Hujan satu-satu & perlahan ===== */
      function startRain(){
        if(raining) return;
        raining = true;
        startBtn.textContent = 'Raining‚Ä¶';
        startBtn.disabled = true;
        stopBtn.disabled = false;

        // Sediakan audio context lepas user gesture
        if(!audioCtx){
          try{ audioCtx = new (window.AudioContext||window.webkitAudioContext)(); }
          catch(e){ /* ignore */ }
        }

        // Loop: 1 titisan sahaja setiap 700‚Äì1100ms (still ‚Äúone by one‚Äù)
        const loop = () => {
          if(!raining) return;
          makeDrop();
          timer = setTimeout(loop, 700 + Math.random()*400);
        };
        loop();
      }
      function stopRain(){
        raining = false;
        startBtn.textContent = 'Start Rain';
        startBtn.disabled = false;
        stopBtn.disabled = true;
        clearTimeout(timer);
      }

      // Satu titisan manual
      function dropOne(){ makeDrop(); }

      // Tap di langit untuk jatuhkan di lokasi sentuhan
      sky.addEventListener('pointerdown', (e)=> makeDrop(e.clientX));

      startBtn.addEventListener('click', startRain);
      stopBtn .addEventListener('click', stopRain);
      oneBtn  .addEventListener('click', dropOne);

      // Mesra mobile: fokus Start
      window.addEventListener('load', ()=> startBtn.focus(), {once:true});
    </script>
  </body>
</html>
